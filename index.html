<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
  <meta charset="UTF-8">
  <title>Cash Register</title>

</head>
<body>

<div class="row">
    <div class="panel panel-default" id="registerDisplay">$0.00</div>
</div>

<div class="grid-container">
  <div class="row">
    <div class="col-sm-1">
      <button class="btn" id="button7">7</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button8">8</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button9">9</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonDivide">รท</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonClear">clear</button>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-1">
      <button class="btn" id="button4">4</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button5">5</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button6">6</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonMultiply">x</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonGetBalance">get balance</button>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-1">
      <button class="btn" id="button1">1</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button2">2</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button3">3</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonSubtract">-</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonDeposit">deposit cash</button>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-1">
      <button class="btn" id="button0">0</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="button00">00</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonDecimal">.</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonAdd">+</button>
    </div>
    <div class="col-sm-1">
      <button class="btn" id="buttonWithdraw">withdraw cash</button>
    </div>
  </div>

  <div class ="row">
    <div class="col-sm-1 col-md-offset-3">
      <button class="btn" id="buttonEquals">=</button>
    </div>
  </div>
</div>

<script src="cash-register.js" type="text/javascript"></script>
<script src="calculator.js"></script>
<script type="text/javascript">

window.onload = function() {
  var calculatorCents = calculatorModule();
  var calculatorDollars = calculatorModule();
  var calculatorDollarsOperationFunction = null;
  var calculatorCentsOperationFunction = null;
  var cashRegister = cashRegisterModule();
  var operatingOnWholeValue = false;
  var display = document.getElementById("registerDisplay");
  var displayDollars = "0";
  var displayCents = "00";
  var decimal = false;
  var decimalIndex = 0;

  function parseWholeNumber() {
    displayCents = Math.round((displayDollars - Math.floor(displayDollars)) * 100);
    displayDollars = Math.floor(displayDollars);
  }

  function checkLeadingNumbers() {
    if (decimalIndex > 1) {
      return false;
    } else {
      return true;
    }
  }

  function updateDisplay(numStr) {

    if (numStr) {
      if (decimal && checkLeadingNumbers()) {
        displayCents = String(displayCents).substr(0, decimalIndex) + numStr + String(displayCents).substr(decimalIndex + 1);
        if (numStr === "0" && decimalIndex <= 1) {
          decimalIndex++;
        }
        else if (numStr !== "0") {
          decimalIndex++;
        }
      }
      else if (!decimal) {
        displayDollars += numStr;
      }
    }

    display.innerHTML = `$${Number(displayDollars)}.${displayCents}`;
  }

  function clearDisplay() {

  displayDollars = "0";
  displayCents = "00";
  decimal = false;
  decimalIndex = 0;

  display.innerHTML = `$${Number(displayDollars)}.${displayCents}`;

  }

  document.getElementById("buttonDecimal").addEventListener("click", function(){
    if (display.innerHTML.search(/\./) === -1) {
      display.innerHTML += ".";
    }
    decimal = true;
  });

  document.getElementById("button0").addEventListener("click", function(){
    updateDisplay("0");
  });

  document.getElementById("button00").addEventListener("click", function(){
    if (decimal) {
      decimalIndex += 2;
    } else {
      displayDollars += "00";
    }
    display.innerHTML = `$${Number(displayDollars)}.${displayCents}`;

  });

  document.getElementById("button1").addEventListener("click", function(){
    updateDisplay("1");
  });

  document.getElementById("button2").addEventListener("click", function(){
    updateDisplay("2");
  });

  document.getElementById("button3").addEventListener("click", function(){
    updateDisplay("3");
  });

  document.getElementById("button4").addEventListener("click", function(){
    updateDisplay("4");
  });

  document.getElementById("button5").addEventListener("click", function(){
    updateDisplay("5");
  });

  document.getElementById("button6").addEventListener("click", function(){
    updateDisplay("6");
  });

  document.getElementById("button7").addEventListener("click", function(){
    updateDisplay("7");
  });

  document.getElementById("button8").addEventListener("click", function(){
    updateDisplay("8");
  });

  document.getElementById("button9").addEventListener("click", function(){
    updateDisplay("9");
  });

  document.getElementById("buttonClear").addEventListener("click", function(){
    clearDisplay();
  });

  document.getElementById("buttonEquals").addEventListener("click", function(){
    if (calculatorDollarsOperationFunction === null) {
      clearDisplay();
    } else {
      if (!operatingOnWholeValue) {
        calculatorDollarsOperationFunction(Number(displayDollars));
        calculatorCentsOperationFunction(Number(displayCents));
        displayDollars = calculatorDollars.getTotal();
        displayCents = calculatorCents.getTotal();
      } else {
        calculatorDollarsOperationFunction(Number(displayDollars) + Number(displayCents) / 100);
        displayDollars = calculatorDollars.getTotal();
        parseWholeNumber();
      }
    }

    if (displayCents < 10) {
      displayCents = "0" + String(displayCents);
    }

    updateDisplay();
    calculatorDollarsOperationFunction = null;
    calculatorCoinsOperationFunction = null;
    decimal = false;
    decimalIndex = 0;

  });

  document.getElementById("buttonAdd").addEventListener("click", function(){
    calculatorDollars.load(Number(displayDollars));
    calculatorCents.load(Number(displayCents));
    calculatorDollarsOperationFunction = calculatorDollars.add;
    calculatorCentsOperationFunction = calculatorCents.add;
    operatingOnWholeValue = false;
    clearDisplay();
  });

  document.getElementById("buttonMultiply").addEventListener("click", function(){
    calculatorDollars.load(Number(displayDollars) + (Number(displayCents) / 100));
    calculatorDollarsOperationFunction = calculatorDollars.multiply;
    operatingOnWholeValue = true;
    clearDisplay();
  });

  document.getElementById("buttonSubtract").addEventListener("click", function(){
    calculatorDollars.load(Number(displayDollars));
    calculatorCents.load(Number(displayCents));
    calculatorDollarsOperationFunction = calculatorDollars.subtract;
    calculatorCentsOperationFunction = calculatorCents.subtract;
    operatingOnWholeValue = false;
    clearDisplay();
  });

  document.getElementById("buttonDivide").addEventListener("click", function(){
    calculatorDollars.load(Number(displayDollars) + (Number(displayCents) / 100));
    calculatorDollarsOperationFunction = calculatorDollars.divide;
    operatingOnWholeValue = true;
    clearDisplay();
  });

  document.getElementById("buttonGetBalance").addEventListener("click", function(){
    displayDollars = cashRegister.getDollars();
    displayCents = cashRegister.getCents();
    if (displayCents < 10) {
      displayCents = "0" + String(displayCents);
    }
    display.innerHTML = `$${Number(displayDollars)}.${displayCents}`;
  });

  document.getElementById("buttonDeposit").addEventListener("click", function(){
    cashRegister.addMoney(Number(displayDollars), Number(displayCents));
    clearDisplay();
  });

  document.getElementById("buttonWithdraw").addEventListener("click", function(){
    cashRegister.subtractMoney(Number(displayDollars), Number(displayCents));
    clearDisplay();
  });


};

</script>


</body>
</html>